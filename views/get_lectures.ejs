<%- include('partials/_header') %>
    <div class="container">
        <div class="upload-container">
            <div class="upload-area" id="uploadArea">
                <div class="upload-animation"></div>
                <i class="fas fa-file-pdf"></i>
                <h3>Upload PDF File</h3>
                <p>Drag & drop your file here or click to browse</p>
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-cloud-upload-alt"></i> Choose File
                </button>
                <p><small>Max file size: 100MB • Supported format: PDF</small></p>
                <input type="file" id="fileInput" class="file-input" accept=".pdf">
            </div>
        </div>

        <div id="progress" class="progress-container" style="display: none;">
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0"
                    aria-valuemax="100">
                    <span class="progress-text">0%</span>
                </div>
            </div>
            <div class="mt-1 fw-bold text-center text-primary">Please wait while processing...</div>
            <div id="progressStatus" class="progress-status mt-2 text-center text-muted">
                Pdf is being processed...
            </div>
        </div>
    </div>

    <div class="alert alert-danger mt-3" id="error" style="display: none;"></div>

    <div class="result mt-4 container" id="result" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h3>Processing Completed</h3>
                <span class="badge bg-success">Sections: <span id="sectionCount">0</span></span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <button class="btn btn-success me-2" onclick="copyText()">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <!-- Button to Open Modal -->
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#lecturesModal">
                  Add Lectures
                </button>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div id="textContent"></div>
                <div id="rawData" style="display: none;">
                    <pre class="mt-3"><code id="rawDataContent"></code></pre>
                </div>
            </div>
        </div>
    </div>

<!-- Bootstrap Modal -->
<div class="modal fade" id="lecturesModal" tabindex="-1" aria-labelledby="lecturesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" id="lecturesModalDialog">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="lecturesModalLabel">Add Lectures JSON</h5>
        <div>
          <!-- Fullscreen toggle button -->
          <button type="button" class="btn btn-sm btn-outline-secondary me-2" id="toggleFullscreenBtn">
            <i class="bi bi-arrows-fullscreen"></i>
          </button>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
      </div>

      <div class="modal-body">
        <!-- POST Form -->
        <form id="lecturesForm">
          <div class="mb-3">
            <label for="courseIdInput" class="form-label">Course ID</label>
            <input type="number" id="courseIdInput" name="courseId" class="form-control" placeholder="Enter Course ID" required>
          </div>
          <div class="mb-3">
            <label for="lecturesInput" class="form-label">Lectures (JSON format)</label>
            <textarea id="lecturesInput" name="lectures" class="form-control" rows="18" placeholder='{
  "Lecture 1": { "start_page": 1, "end_page": 10 },
  "Lecture 2": { "start_page": 11, "end_page": 20 }
}' required></textarea>
          </div>
          <button type="submit" class="btn btn-success w-100">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap Icons (add this in your HTML <head> if not already included) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">


<script>

     // ===== Handle Fullscreen Toggle =====
  const modalDialog = document.getElementById('lecturesModalDialog');
  const toggleBtn = document.getElementById('toggleFullscreenBtn');
  let isFullscreen = false;

  toggleBtn.addEventListener('click', () => {
    isFullscreen = !isFullscreen;
    modalDialog.classList.toggle('modal-fullscreen', isFullscreen);
    toggleBtn.innerHTML = isFullscreen 
      ? '<i class="bi bi-fullscreen-exit"></i>' 
      : '<i class="bi bi-arrows-fullscreen"></i>';
  });

  document.getElementById('lecturesForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    try {
      const textarea = document.getElementById('lecturesInput');
      const courseIdInput = document.getElementById('courseIdInput');
      const COURSE_ID = courseIdInput.value.trim();

      // Parse JSON safely
      const lecturesJSON = JSON.parse(textarea.value.trim());

      const response = await fetch(`/create_lectures/${COURSE_ID}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(lecturesJSON)
      });

      const result = await response.json();

      if(!result.success) {
        showAlert('❌ Error: ' + (result.message || 'Something went wrong'));
        return;
      }

      if (result.success) {
        showAlert('✅ Lectures created successfully!');
        textarea.value = '';
        courseIdInput.value = '';

        // Close modal safely
        const modalElement = document.getElementById('lecturesModal');
        let modal = bootstrap.Modal.getInstance(modalElement);
        if (!modal) {
          modal = new bootstrap.Modal(modalElement);
        }
        modal.hide();
      } else {
        alert('❌ Error: ' + (result.message || 'Something went wrong'));
      }
    } catch (err) {
      alert('⚠️ Invalid JSON or network error.');
      console.error(err);
    }
  });
</script>


   <script src="/getLecures.js"></script>

    <%- include('partials/_footer') %>